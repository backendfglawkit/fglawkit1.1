from dataclasses import field
from typing import Optional, Union

from dataclasses_json import dataclass_json, LetterCase
from dataclasses import dataclass

from phonepe.sdk.pg.payments.models.request_v1.pg_instrument_type import PgInstrumentType
from phonepe.sdk.pg.payments.models.response_v1.pay_response_models.pay_instrument_response_models.card_instrument_response import \
    CardInstrumentResponse
from phonepe.sdk.pg.payments.models.response_v1.pay_response_models.pay_instrument_response_models.net_banking_instrument_response import \
    NetBankingInstrumentResponse
from phonepe.sdk.pg.payments.models.response_v1.pay_response_models.pay_instrument_response_models.pay_page_instrument_response import \
    PayPageInstrumentResponse
from phonepe.sdk.pg.payments.models.response_v1.pay_response_models.pay_instrument_response_models.saved_card_instrument_response import \
    SavedCardInstrumentResponse
from phonepe.sdk.pg.payments.models.response_v1.pay_response_models.pay_instrument_response_models.token_instrument_response import \
    TokenInstrumentResponse
from phonepe.sdk.pg.payments.models.response_v1.pay_response_models.pay_instrument_response_models.upi_collect_instrument_response import \
    UpiCollectInstrumentResponse
from phonepe.sdk.pg.payments.models.response_v1.pay_response_models.pay_instrument_response_models.upi_intent_instrument_response import \
    UpiIntentInstrumentResponse
from phonepe.sdk.pg.payments.models.response_v1.pay_response_models.pay_instrument_response_models.upi_qr_instrument_response import \
    UpiQrInstrumentResponse


@dataclass_json(letter_case=LetterCase.CAMEL)
@dataclass
class PgPayResponse:
    merchant_id: Optional[str] = field(default=None)
    merchant_transaction_id: Optional[str] = field(default=None)
    transaction_id: Optional[str] = field(default=None)
    instrument_response: Optional[Union[
        PayPageInstrumentResponse, CardInstrumentResponse, TokenInstrumentResponse, UpiQrInstrumentResponse,
        SavedCardInstrumentResponse, NetBankingInstrumentResponse, UpiIntentInstrumentResponse,
        UpiCollectInstrumentResponse]] = field(default=None)

    def __post_init__(self):
        instrument_mapper = {PgInstrumentType.CARD.value: CardInstrumentResponse,
                             PgInstrumentType.TOKEN.value: TokenInstrumentResponse,
                             PgInstrumentType.UPI_QR.value: UpiQrInstrumentResponse,
                             PgInstrumentType.SAVED_CARD.value: SavedCardInstrumentResponse,
                             PgInstrumentType.NET_BANKING.value: NetBankingInstrumentResponse,
                             PgInstrumentType.PAY_PAGE.value: PayPageInstrumentResponse,
                             PgInstrumentType.UPI_INTENT.value: UpiIntentInstrumentResponse,
                             PgInstrumentType.UPI_COLLECT.value: UpiCollectInstrumentResponse}
        if self.instrument_response and instrument_mapper.get(self.instrument_response.get("type")):
            instrument_type = instrument_mapper.get(self.instrument_response.get("type"))
            self.instrument_response = instrument_type.from_dict(self.instrument_response)
