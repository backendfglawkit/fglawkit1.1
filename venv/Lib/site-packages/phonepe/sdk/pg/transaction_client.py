from abc import ABC

import phonepe
from phonepe.sdk.pg.common.configs.merchant_config import MerchantConfig
from phonepe.sdk.pg.common.constants import SOURCE, INTEGRATION, SOURCE_VERSION, SOURCE_PLATFORM, SDK_TYPE, \
    API_VERSION, \
    SOURCE_PLATFORM_VERSION, X_MERCHANT_ID
from phonepe.sdk.pg.common.http_client_modules.api_requestor import ApiRequestor
from phonepe.sdk.pg.common.utils.checksum_utils import generate_headers
from phonepe.sdk.pg.common.utils.general_utils import merge_dict


class TransactionClient(ABC):
    """Bundles configs and data required to perform operations"""

    def __init__(self, api_request_maker: ApiRequestor, merchant_config: MerchantConfig):
        self._api_request_maker = api_request_maker
        self._merchant_config = merchant_config

    def get_headers(self, url: str, body: dict = {}):
        headers = {SOURCE: INTEGRATION,
                   SOURCE_VERSION: API_VERSION,
                   SOURCE_PLATFORM: SDK_TYPE,
                   SOURCE_PLATFORM_VERSION: phonepe.__version__,
                   X_MERCHANT_ID: self._merchant_config.merchant_id}
        return merge_dict(headers, generate_headers(body, url, self._merchant_config.salt_key,
                                                    self._merchant_config.salt_index))
