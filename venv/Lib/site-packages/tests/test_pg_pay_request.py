from unittest import TestCase

from phonepe.sdk.pg.payments.models.request_v1.pg_pay_request import PgPayRequest


class TestPgPayRequest(TestCase):

    def test_pay_page(self):
        instrument = PgPayRequest.pay_page_pay_request_builder(merchant_transaction_id="mtid",
                                                               amount=100)
        assert instrument.to_dict() == {'merchantTransactionId': 'mtid', 'amount': 100,
                                        'paymentInstrument': {'type': 'PAY_PAGE'}, 'merchantId': None,
                                        'merchantOrderId': None, 'merchantUserId': None, 'cancelRedirectUrl': None,
                                        'redirectUrl': None, 'redirectMode': None, 'callbackUrl': None,
                                        'callbackMode': None, 'deviceContext': {'deviceOS': None},
                                        'autoFailureTimeout': None}

    def test_build_card_payment_instrument(self):
        instrument = PgPayRequest.card_pay_request_builder(merchant_transaction_id="mtid",
                                                           amount=100,
                                                           auth_mode="3DS",
                                                           save_card=True,
                                                           encrypted_card_number="123",
                                                           encryption_key_id=2,
                                                           card_holder_name="name",
                                                           expiry_month="12",
                                                           expiry_year="2022",
                                                           encrypted_cvv="122")
        assert instrument.to_dict() == {'merchantTransactionId': 'mtid', 'amount': 100,
                                        'paymentInstrument': {'saveCard': True,
                                                              'cardDetails': {'encryptedCardNumber': '123',
                                                                              'encryptionKeyId': 2,
                                                                              'cardHolderName': 'name',
                                                                              'expiry': {'month': '12', 'year': '2022'},
                                                                              'encryptedCvv': '122',
                                                                              'billingAddress': {'line1': None,
                                                                                                 'line2': None,
                                                                                                 'city': None,
                                                                                                 'state': None,
                                                                                                 'zip': None,
                                                                                                 'country': None}},
                                                              'authMode': '3DS', 'type': 'CARD'}, 'merchantId': None,
                                        'merchantOrderId': None, 'merchantUserId': None, 'cancelRedirectUrl': None,
                                        'redirectUrl': None, 'redirectMode': None, 'callbackUrl': None,
                                        'callbackMode': None, 'deviceContext': {'deviceOS': None},
                                        'autoFailureTimeout': None}
